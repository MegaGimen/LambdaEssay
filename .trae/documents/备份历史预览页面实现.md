## 目标

* 新增 `frontend/lib/backup.dart` 页面，支持下载并预览远程备份中记录的子仓库历史状态。

* 顶部提供按时间范围与作者筛选父仓库 `master` 分支上的提交。

* 列表中按时间排序渲染多个“子仓库只读视图”，支持切换分支、预览文件；禁用写操作，包括push、pull、commit等内容，（push/pull/commit/merge/reset）。

* 在 `main.dart` 中提供入口打开该历史预览窗口。

## 远程接口约定（运行在备份服务器）

* `GET http://47.242.109.145:4829/backups/<repo>/download`：下载父仓库 ZIP 用于校验/离线缓存。其中包含了全部的分支

* `服务器只包含下载逻辑，没有其他的逻辑。其他的逻辑可以参见运行在8080端口的本地后端服务器`

## 前端页面结构（backup.dart）

* 顶栏：

  * repo name的显示（他是自动从当前正在打开的项目中读取的）

  * 按钮：`加载备份`（触发下载 ZIP 与加载 `commits` 元数据）

  * 筛选器：作者文本框；时间范围选择（起止日期）；筛选按钮

* 内容区：

  * 根据筛选结果，按时间排序展示多个只读“子仓库视图”卡片：每个卡片包含一个 `_GraphView` 的只读实例或文件浏览器占位，当 GraphData 加载失败时仅显示基本信息与重试按钮。

  * 懒加载：在把下载下来的父文件夹解压后，把这个父仓库放到临时文件。注意，父仓库的每一个commit都对应了子仓库的一个快照。而对这个父仓库进行展开操作，让他展开成一个个的子仓库的状态，以便在查看时可以快速调用。在本地后端（本地后端的port是8080，而不是4829）中添加`child/<sha>/graph来支持渲染`

* 辅助：

  * 错误提示与重试；空态展示，但是在屏幕上报错。

## 复用现有渲染逻辑（只读模式）

* 复用 `_GraphView`（`frontend/lib/main.dart`），新增 `readOnly: bool` 与可选的本地分支切换处理。

  * 隐藏写操作按钮：

    * 提交更改按钮（main.dart:2696 一带）

    * 新建分支、合并分支、回退、重置分支等所有会命中 `http://localhost:8080/...` 的写接口

  * 保留：

    * 分支图例与“切换分支”交互，但在只读模式下不调用后端切换接口（`_doSwitchBranch`），改为本地更新 `GraphData.currentBranch` 并重绘。

    * 节点双击的“预览该版本”为访问本地缓存的子仓库的状态

* GraphPainter 与交互：保持不变，仅依据传入的 `GraphData` 绘制；读写分离由 `_GraphView` 层控制。

## 滚动与交互不冲突

* 每个只读 `_GraphView` 外层使用固定高度容器（如 `SizedBox(height: 600)`），使上层 `ListView` 控制滚动；内部 `InteractiveViewer` 的平移缩放与外层滚动互不影响。

* 保留 `_GraphView` 内部的右键拖动与双击逻辑；必要时在只读模式下减少手势竞争（例如降低边缘 `boundaryMargin`）。

## 数据加载与状态管理

* 首次点击“加载备份”：

  * 请求 `commits` 列表，保存到页面状态。

  * 应用筛选器后，渲染卡片；每个卡片在首次可见时请求 `child/<sha>/graph`。

* 提供本地缓存：已加载的 GraphData 缓存在内存 Map（`sha -> GraphData`）。

* 下载 ZIP：完成后仅用于校验或离线缓存，不强依赖客户端解压。

## 与 main.dart 集成

* 在 `MaterialApp` 增加路由或在 AppBar 添加入口按钮，`Navigator.push` 到 `BackupPage`。

* 不干扰现有 `GraphPage` 工作流；只读视图不触发 `localhost:8080` 的写端点。

## 验证与回退策略

* 功能验证：

  * 常见仓库加载与筛选；多卡片懒加载；只读模式下所有写操作隐藏或禁用。

  * 分支切换只影响前端高亮与渲染，不修改服务器状态。

* 性能与安全：

  * 对大备份仓库采用分页/懒加载；避免长时间主线程阻塞。

  * 所有网络请求增加错误处理与超时。

## 需要的最小改动清单

* 新增文件：`frontend/lib/backup.dart`（`BackupPage` 实现）。

* 轻微改动：`_GraphView` 增加 `readOnly` 参数与本地分支切换支持；隐藏写操作入口。

* 入口：在 `main.dart` 增加“历史备份预览”导航。

* 轻微改动：server/lib/server.dart，让他支持`child/<sha>/graph的操作`

## 依赖与假设

* 假设备份服务器实现了 `commits` 与 `child/<sha>/graph` 等端点；若未实现，需后端配合补充。

* 不新增第三方解析 Git 的依赖；尽量由服务端生成 `GraphData`，前端只渲染。

